<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>Selection Test</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 20px;
    }

    table.selection-table {
      border-collapse: collapse;
      margin: 0 auto 20px auto;
      width: 80%;
      max-width: 800px;
      background-color: #fff;
    }
    table.selection-table th, table.selection-table td {
      border: 1px solid #888;
      padding: 6px 10px;
      text-align: center;
    }
    table.selection-table thead {
      background-color: #f0f0f0;
      font-weight: bold;
    }

    .tabs {
      text-align: center;
      margin-bottom: 10px;
    }
    .tablink {
      display: inline-block;
      padding: 8px 16px;
      margin: 0 4px;
      border: none;
      border-radius: 4px 4px 0 0;
      background: #ddd;
      cursor: pointer;
      font-size: 14px;
    }
    .tablink.active {
      background: #0078d7;
      color: #fff;
    }
    .tabcontent {
      display: none;
    }

    fieldset.control-block {
      display: block;
      margin: 15px auto;
      padding: 15px;
      width: 400px;
      max-width: 95%;
      border: 1px solid #aaa;
      border-radius: 6px;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    fieldset.control-block legend {
      font-weight: bold;
    }
    fieldset.control-block label {
      display: inline-block;
      width: 140px;
      text-align: right;
      margin-right: 8px;
    }
    fieldset.control-block input[type="number"] {
      width: 120px;
      padding: 3px;
      margin: 3px 0;
    }
    fieldset.control-block input[type="button"] {
      margin: 4px 0;
      padding: 4px 10px;
      cursor: pointer;
    }

    .info-box {
      margin-top: 10px;
      padding: 6px;
      background-color: #f9f9f9;
      border: 1px dashed #aaa;
      font-size: 12px;
      min-height: 30px;
      white-space: pre-wrap;
    }

    a {
      display: block;
      text-align: center;
      margin-top: 20px;
    }
  </style>

  <script type="text/javascript">
    // обновление таблицы выделения
    function UpdateSelectedElements () {
      ACAPI.GetSelectedElements().then(function (elemInfos) {
        var selectionTable = document.getElementById('selection');
        while (selectionTable.firstChild) selectionTable.removeChild(selectionTable.firstChild);

        if (elemInfos.length === 0) {
          var tr = document.createElement('tr');
          tr.innerHTML = '<td colspan="3">Нет выбранных элементов</td>';
          selectionTable.appendChild(tr);
          return;
        }

        var grouped = {};
        for (var i = 0; i < elemInfos.length; i++) {
          var typeName = elemInfos[i][1];
          var elemID   = elemInfos[i][2];
          var key = typeName + "||" + elemID;
          if (!grouped[key]) grouped[key] = { type: typeName, id: elemID, count: 0 };
          grouped[key].count++;
        }

        for (var key in grouped) {
          var tr = document.createElement('tr');
          tr.innerHTML =
            '<td>'+grouped[key].type+'</td>'+
            '<td>'+grouped[key].id+'</td>'+
            '<td>'+grouped[key].count+'</td>';
          selectionTable.appendChild(tr);
        }
      });
    }

    function setInfo(id, msg) {
      document.getElementById(id).innerText = msg;
    }

    // функции
    function RotateSelection() {
  var s = document.getElementById('rotateAngle').value;
  ACAPI.RotateSelected(s);
  setInfo("info-orient", "Повернули на " + s + "°");
}
function AlignSelectionX() {
  ACAPI.AlignSelectedX();
  setInfo("info-orient", "Выравнивание по X");
}
function RandomizeAngles() {
  ACAPI.RandomizeSelectedAngles();
  setInfo("info-orient", "Случайный угол задан");
}
function OrientObjectsToPoint() {
  ACAPI.OrientObjectsToPoint();
  setInfo("info-orient", "Сориентированы на точку");
}


    function SetDistributionLine(){ACAPI.SetDistributionLine();setInfo("info-dist","Линия задана");}
    function SetDistributionObject(){ACAPI.SetDistributionObject();setInfo("info-dist","Объект задан");}
    function SetDistributionStep(){var s=document.getElementById('distStep').value;ACAPI.SetDistributionStep(s);setInfo("info-dist","Шаг="+s);}
    function SetDistributionCount(){var c=document.getElementById('distCount').value;ACAPI.SetDistributionCount(c);setInfo("info-dist","Количество="+c);}
    function DistributeNow(){var s=document.getElementById('distStep').value;var c=document.getElementById('distCount').value;var p=s?("step:"+s):("count:"+c);ACAPI.DistributeNow(p).then(ok=>setInfo("info-dist",ok?"✔ Выполнено":"❌ Ошибка"));}

    function SetGroundSurface(){ACAPI.SetGroundSurface();setInfo("info-ground","Поверхность выбрана");}
    function SetGroundObjects(){ACAPI.SetGroundObjects();setInfo("info-ground","Объекты выбраны");}
    function ApplyGroundOffset(){var z=document.getElementById('groundOffset').value;ACAPI.ApplyGroundOffset(z);setInfo("info-ground","Приземление Z="+z);}

    function CreateSlabAlongCurve(){var w=document.getElementById('slabWidth').value;ACAPI.CreateSlabAlongCurve(w);setInfo("info-build","Перекрытие, ширина="+w);}
    function CreateShellAlongCurve(){var w=document.getElementById('shellWidth').value;ACAPI.CreateShellAlongCurve(w,"line");setInfo("info-build","Оболочка, ширина="+w);}

    // вкладки
    function openTab(evt, tabId) {
      var i, contents=document.getElementsByClassName("tabcontent"), links=document.getElementsByClassName("tablink");
      for(i=0;i<contents.length;i++) contents[i].style.display="none";
      for(i=0;i<links.length;i++) links[i].classList.remove("active");
      document.getElementById(tabId).style.display="block";
      evt.currentTarget.classList.add("active");
    }
    window.addEventListener('DOMContentLoaded',function(){document.getElementById("defaultTab").click();});
  </script>
</head>

<body>
  <!-- Таблица выделения -->
  <table class="selection-table">
    <thead><tr><th colspan="3">Выбранные элементы:</th></tr><tr><th>Тип</th><th>ID</th><th>Кол-во</th></tr></thead>
    <tbody id="selection"><tr><td colspan="3">Нет выбранных элементов</td></tr></tbody>
  </table>

  <!-- Вкладки -->
  <div class="tabs">
    <button id="defaultTab" class="tablink" onclick="openTab(event,'tab-build')">Построение</button>
    <button class="tablink" onclick="openTab(event,'tab-distrib')">Распределение</button>
    <button class="tablink" onclick="openTab(event,'tab-orient')">Ориентация</button>
    <button class="tablink" onclick="openTab(event,'tab-ground')">Приземление</button>
  </div>

  <!-- Построение -->
  <div id="tab-build" class="tabcontent">
    <fieldset class="control-block">
      <legend>Перекрытие по линии</legend>
      <div style="text-align:center; margin-bottom:6px;">
        <input type="button" onclick="ACAPI.SetCurveForSlab()" value="Выбрать линию">
      </div>
      <div>
        <label>Ширина:</label>
        <input type="number" id="slabWidth" step="1" value="0">
        <input type="button" onclick="CreateSlabAlongCurve()" value="Построить Перекрытие">
      </div>
    </fieldset>

    <fieldset class="control-block">
      <legend>Оболочка по линии</legend>
      <div style="text-align:center; margin-bottom:6px;">
        <input type="button" onclick="ACAPI.SetCurveForShell()" value="Выбрать линию"><br><br>
        <input type="button" onclick="ACAPI.SetMeshForShell()" value="Выбрать 3D сетку">
      </div>
      <div>
        <label>Ширина:</label>
        <input type="number" id="shellWidth" step="1" value="0">
        <input type="button" onclick="CreateShellAlongCurve()" value="OK">
      </div>
      <div style="text-align:center; margin-top:10px;">
        <input type="button" onclick="CreateShellAlongCurve()" value="Построить Оболочку">
      </div>
      <div id="info-build" class="info-box">Подсказка: выберите линию/сетку и задайте параметры</div>
    </fieldset>
  </div>

  <!-- Распределение -->
  <div id="tab-distrib" class="tabcontent">
    <fieldset class="control-block">
      <legend>Распределение</legend>
      <div style="text-align:center;">
        <input type="button" onclick="SetDistributionLine()" value="Задать линию"><br><br>
        <input type="button" onclick="SetDistributionObject()" value="Задать объект">
      </div>
      <div>
        <label>Расстояние:</label>
        <input type="number" id="distStep" step="1" value="0">
        <input type="button" onclick="SetDistributionStep()" value="OK">
      </div>
      <div>
        <label>Количество:</label>
        <input type="number" id="distCount" step="1" value="1">
        <input type="button" onclick="SetDistributionCount()" value="OK">
      </div>
      <div style="text-align:center; margin-top:10px;">
        <input type="button" onclick="DistributeNow()" value="Распределить">
      </div>
      <div id="info-dist" class="info-box">Подсказка: задайте параметры</div>
    </fieldset>
  </div>

<!-- Ориентация -->
<div id="tab-orient" class="tabcontent">
  <fieldset class="control-block">
    <legend>Ориентация</legend>
    <div>
      <label>Угол:</label>
      <input type="number" id="rotateAngle" step="1" value="0">
      <input type="button" onclick="RotateSelection()" value="Повернуть">
    </div>
    <div style="text-align:center; margin-top:10px;">
      <input type="button" onclick="AlignSelectionX()" value="Выровнять по X"><br><br>
      <input type="button" onclick="RandomizeAngles()" value="Случайный угол (0-360)"><br><br>
      <input type="button" onclick="OrientObjectsToPoint()" value="Сориентировать на точку">
    </div>
    <div id="info-orient" class="info-box">Подсказка: задайте угол или выберите действие</div>
  </fieldset>
</div>

  <!-- Приземление -->
  <div id="tab-ground" class="tabcontent">
    <fieldset class="control-block">
      <legend>Приземление</legend>
      <div style="text-align:center;">
        <input type="button" onclick="SetGroundSurface()" value="Задать поверхность"><br><br>
        <input type="button" onclick="SetGroundObjects()" value="Задать объекты">
      </div>
      <div>
        <label>Смещение Z:</label>
        <input type="number" id="groundOffset" step="1" value="0">
        <input type="button" onclick="ApplyGroundOffset()" value="OK">
      </div>
      <div id="info-ground" class="info-box">Подсказка: выберите поверхность и смещение</div>
    </fieldset>
  </div>

  <a href="https://www.227.info">www.227.info</a>
</body>
</html>
